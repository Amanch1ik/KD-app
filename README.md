# Karakol Delivery Backend API

–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –±—ç–∫–µ–Ω–¥ –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏ –µ–¥—ã –≤ –ö–∞—Ä–∞–∫–æ–ª–µ.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git clone https://github.com/Amanch1ik/Karakol-delivery-backend.git
cd Karakol-delivery-backend

# –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
python -m venv .venv
source .venv/bin/activate  # Linux/Mac
# –∏–ª–∏
.venv\Scripts\activate     # Windows

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
python manage.py migrate

# –°–æ–∑–¥–∞–Ω–∏–µ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
python manage.py createsuperuser

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
python manage.py runserver
```

–°–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: `http://127.0.0.1:8000/`

## üìö API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –ë–∞–∑–æ–≤—ã–π URL
```
http://127.0.0.1:8000/api/
```

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç JWT —Ç–æ–∫–µ–Ω—ã –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.

#### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```http
POST /api/register/
Content-Type: application/json

{
    "username": "testuser",
    "email": "test@example.com",
    "password": "your_password",
    "password2": "your_password",
    "phone_number": "+996777123456"
}
```

#### –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ (–ª–æ–≥–∏–Ω)
```http
POST /api/token/
Content-Type: application/json

{
    "username": "testuser",
    "password": "your_password"
}
```

#### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
```http
POST /api/token/refresh/
Content-Type: application/json

{
    "refresh": "your_refresh_token"
}
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
–î–æ–±–∞–≤—å—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∫ –∑–∞–ø—Ä–æ—Å–∞–º:
```
Authorization: Bearer your_access_token
```

## üè™ –û—Å–Ω–æ–≤–Ω—ã–µ API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤
```http
GET /api/categories/          # –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
GET /api/categories/{id}/     # –î–µ—Ç–∞–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
```

### –¢–æ–≤–∞—Ä—ã
```http
GET /api/products/                    # –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤
GET /api/products/{id}/              # –î–µ—Ç–∞–ª–∏ —Ç–æ–≤–∞—Ä–∞
GET /api/products/by_category/?category_id=1  # –¢–æ–≤–∞—Ä—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
```

### –†–µ—Å—Ç–æ—Ä–∞–Ω—ã
```http
GET /api/restaurants/        # –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤
GET /api/restaurants/{id}/   # –î–µ—Ç–∞–ª–∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞
```

### –ö–æ—Ä–∑–∏–Ω–∞ –∏ –∑–∞–∫–∞–∑—ã

#### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω—É
```http
POST /api/order-items/
Authorization: Bearer your_token
Content-Type: application/json

{
    "product": 1,
    "quantity": 2
}
```

#### –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–æ—Ä–∑–∏–Ω—ã
```http
GET /api/order-items/
Authorization: Bearer your_token
```

#### –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞
```http
POST /api/orders/
Authorization: Bearer your_token
Content-Type: application/json

{
    "delivery_address": "—É–ª. –õ–µ–Ω–∏–Ω–∞, 10, –∫–≤. 5",
    "phone_number": "+996555987654",
    "customer_name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
    "restaurant": 1,
    "payment_method": "cash"
}
```

#### –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–∫–∞–∑–æ–≤
```http
GET /api/orders/             # –ú–æ–∏ –∑–∞–∫–∞–∑—ã (–∫–ª–∏–µ–Ω—Ç) –∏–ª–∏ –≤—Å–µ (–∞–¥–º–∏–Ω)
GET /api/orders/{id}/        # –î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞
```

### –ö—É—Ä—å–µ—Ä—ã

#### –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫—É—Ä—å–µ—Ä—ã
```http
GET /api/delivery-persons/available/
Authorization: Bearer your_token
```

#### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è –∫—É—Ä—å–µ—Ä–∞
```http
POST /api/delivery-persons/{id}/update_location/
Authorization: Bearer your_token
Content-Type: application/json

{
    "latitude": 42.4907,
    "longitude": 78.3936,
    "status": "available"
}
```

### –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤
```http
GET /api/orders/{id}/tracking/
Authorization: Bearer your_token
```

### –†–µ–π—Ç–∏–Ω–≥–∏
```http
POST /api/orders/{id}/rate/
Authorization: Bearer your_token
Content-Type: application/json

{
    "score": 5,
    "comment": "–û—Ç–ª–∏—á–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞!"
}
```

### –ü–ª–∞—Ç–µ–∂–∏
```http
GET /api/payments/                    # –ú–æ–∏ –ø–ª–∞—Ç–µ–∂–∏
POST /api/payments/{id}/initiate/     # –ò–Ω–∏—Ü–∏–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–∞
POST /api/payments/{id}/callback/     # –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–∞
```

### –ö–∞—Ä—Ç–∞
```http
GET /api/map/data/                    # –í—Å–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–∞—Ä—Ç—ã
GET /api/map/delivery_persons/        # –¢–æ–ª—å–∫–æ –∫—É—Ä—å–µ—Ä—ã
GET /api/map/active_orders/           # –¢–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã
```

## üë• –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –ö–ª–∏–µ–Ω—Ç
- –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–æ–≤–∞—Ä–æ–≤ –∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω–æ–π
- –°–æ–∑–¥–∞–Ω–∏–µ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤
- –û—Ü–µ–Ω–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏

### –ö—É—Ä—å–µ—Ä
- –ü—Ä–æ—Å–º–æ—Ç—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è
- –ü—Ä–∏–Ω—è—Ç–∏–µ/–æ—Ç–º–µ–Ω–∞ –∑–∞–∫–∞–∑–æ–≤
- –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ –±–∞–ª–∞–Ω—Å–∞

### –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
- –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –¥–∞–Ω–Ω—ã–º
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫—É—Ä—å–µ—Ä–æ–≤
- –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

### –ü–∞—Ä—Ç–Ω–µ—Ä-—Ä–µ—Å—Ç–æ—Ä–∞–Ω
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞
- –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–∫–∞–∑–æ–≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

### CORS
CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
```python
CORS_ALLOW_ALL_ORIGINS = True
```

### –ü–∞–≥–∏–Ω–∞—Ü–∏—è
–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 20 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
```http
GET /api/products/?page=1
```

### –ü–æ–∏—Å–∫
```http
GET /api/products/?search=–ø–∏—Ü—Ü–∞
GET /api/restaurants/?search=—Ä–µ—Å—Ç–æ—Ä–∞–Ω
```

### –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
```http
GET /api/products/?ordering=price
GET /api/products/?ordering=-price
```

## üì± Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –¥–ª—è:
- –ù–æ–≤—ã—Ö –∑–∞–∫–∞–∑–æ–≤ –¥–ª—è –∫—É—Ä—å–µ—Ä–æ–≤
- –û–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏—è –∫—É—Ä—å–µ—Ä–∞

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
```http
POST /api/device-tokens/
Authorization: Bearer your_token
Content-Type: application/json

{
    "registration_id": "device_token_here",
    "device_type": "android"
}
```

## üó∫Ô∏è –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–∞—Ä—Ç–∞–º–∏

### 2GIS API
–ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å 2GIS –¥–ª—è:
- –†–∞—Å—á–µ—Ç –º–∞—Ä—à—Ä—É—Ç–æ–≤
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π
- –ì–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–¥—Ä–µ—Å–æ–≤

### –ü–æ–ª—É—á–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞
```http
GET /api/orders/{id}/get_route/
Authorization: Bearer your_token
```

## üí≥ –ü–ª–∞—Ç–µ–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã

–ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å:
- PayBox
- MBANK
- –≠–ª—å–∫–∞—Ä—Ç
- Visa/MasterCard

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- JWT —Ç–æ–∫–µ–Ω—ã —Å –∫–æ—Ä–æ—Ç–∫–∏–º –≤—Ä–µ–º–µ–Ω–µ–º –∂–∏–∑–Ω–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
- –†–æ–ª–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç—É–ø–∞
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –ü—Ä–æ–¥–∞–∫—à–Ω –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
1. –ò–∑–º–µ–Ω–∏—Ç–µ `DEBUG = False` –≤ settings.py
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ `ALLOWED_HOSTS`
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ PostgreSQL –≤–º–µ—Å—Ç–æ SQLite
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
5. –î–æ–±–∞–≤—å—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç

### Docker (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```bash
docker build -t karakol-delivery .
docker run -p 8000:8000 karakol-delivery
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏:
- –°–æ–∑–¥–∞–π—Ç–µ Issue –≤ GitHub
- –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ API
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License